"use strict";var Editor=function e(){this._elTrayImages=document.getElementById("tray-images"),this._collage=new Collage,this._elCollageFrame=this._collage._elCollage.parentElement,this._elCollageScrollContainer=document.getElementById("collage-scroll-container"),this._wasDraggedFromTray,this._elCanvasSize=document.getElementById("canvas-size")};Editor.prototype.initialise=function(){var t=this;this.fitCollage(),window.addEventListener("resize",this.fitCollage.bind(this)),this._elTrayImages.querySelectorAll(".gallery-image").forEach(function(e){e.addEventListener("dragstart",t.onTrayImageDragstart.bind(t))}),this._elCollageFrame.addEventListener("dragover",this.onCollageDragover.bind(this)),this._collage._elCollage.addEventListener("dragover",this.onCollageDragover.bind(this)),this._elCollageFrame.addEventListener("drop",this.onCollageDrop.bind(this)),this._collage._elCollage.querySelectorAll(".photo").forEach(function(e){e.addEventListener("dragstart",t.onCollageImageDragstart.bind(t))}),this._collage._elCollage.querySelectorAll(".photo").forEach(function(e){e.addEventListener("dragover",t.onCollageImageDragover.bind(t))}),this._collage._elCollage.querySelectorAll(".photo").forEach(function(e){e.addEventListener("drop",t.onCollageImageDrop.bind(t))}),this._elTrayImages.addEventListener("dragover",this.onTrayDragover.bind(this)),this._elTrayImages.addEventListener("drop",this.onTrayDrop.bind(this)),document.addEventListener("dragleave",this.onDragleave.bind(this)),document.addEventListener("dragend",this.onDragend.bind(this))},Editor.prototype.fitCollage=function(){this._collage.setScale(1);var e=(this._elCollageScrollContainer.clientWidth-40)/this._elCollageFrame.scrollHeight,t=(this._elCollageScrollContainer.clientHeight-40)/this._elCollageFrame.scrollHeight,a=Math.min(e,t);this._collage.setScale(a),this._elCanvasSize.textContent=Math.round(100*a).toString()+"%"},Editor.prototype.onTrayImageDragstart=function(e){e.dataTransfer.setData("text/uri-list",e.target.src),this._wasDraggedFromTray=!0,this._elCollageFrame.setAttribute("droppable","true"),document.body.classList.add("dragging")},Editor.prototype.onCollageDragover=function(e){e.preventDefault(),this._wasDraggedFromTray?this._elCollageFrame.classList.add("active-drop-target"):console.log()},Editor.prototype.onCollageDrop=function(e){if(e.preventDefault(),this._wasDraggedFromTray){var t=e.dataTransfer.getData("text/uri-list"),a=this._collage.addPhoto(t);a.addEventListener("dragstart",this.onCollageImageDragstart.bind(this)),a.addEventListener("dragover",this.onCollageImageDragover.bind(this)),a.addEventListener("drop",this.onCollageImageDrop.bind(this))}},Editor.prototype.onCollageImageDragstart=function(e){var a=this,o=this._collage.getIndexOfPhoto(e.target);e.dataTransfer.setData("text/plain",o.toString()),this._wasDraggedFromTray=!1,this._elCollageFrame.querySelectorAll(".photo").forEach(function(e){var t;a._collage.getIndexOfPhoto(e)!==o&&e.setAttribute("droppable","true")}),this._elTrayImages.setAttribute("droppable","true"),document.body.classList.add("dragging")},Editor.prototype.onCollageImageDragover=function(e){e.preventDefault(),this._wasDraggedFromTray||e.target.classList.add("active-drop-target")},Editor.prototype.onCollageImageDrop=function(e){if(e.preventDefault(),!this._wasDraggedFromTray){var t=parseInt(e.dataTransfer.getData("text/plain")),a=this._collage.getIndexOfPhoto(e.target);this._collage.swapPhotos(t,a),e.target}},Editor.prototype.onTrayDragover=function(e){e.preventDefault(),this._wasDraggedFromTray||e.target.classList.add("active-drop-target")},Editor.prototype.onTrayDrop=function(e){if(e.preventDefault(),!this._wasDraggedFromTray){var t=parseInt(e.dataTransfer.getData("text/plain"));this._collage.removePhoto(t)}this.onDragend()},Editor.prototype.onDragleave=function(e){e.target.classList.remove("active-drop-target")},Editor.prototype.onDragend=function(e){console.log("Dragend"),document.querySelectorAll(".active-drop-target").forEach(function(e){console.log(e),e.classList.remove("active-drop-target")}),this._elTrayImages.setAttribute("droppable","false"),this._elCollageFrame.setAttribute("droppable","false"),this._elCollageFrame.querySelectorAll(".photo").forEach(function(e){e.setAttribute("droppable","false")}),document.body.classList.remove("dragging")},document.addEventListener("DOMContentLoaded",function(){window._editor=new Editor,window._editor.initialise()});